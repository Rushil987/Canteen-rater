{% extends 'menu/base.html' %}

{% block content %}
    <h1>Admin Dashboard</h1>

    <h2>Most Liked Dish</h2>
    {% if most_liked %}
        <p><strong>{{ most_liked.name }}</strong> (Avg Rating: {{ most_liked.avg_rating|floatformat:1 }})</p>
    {% else %}
        <p>No ratings yet.</p>
    {% endif %}

    <h2>Least Liked Dish</h2>
    {% if least_liked %}
        <p><strong>{{ least_liked.name }}</strong> (Avg Rating: {{ least_liked.avg_rating|floatformat:1 }})</p>
    {% else %}
        <p>No ratings yet.</p>
    {% endif %}

    <h2>Average Rating per Day</h2>
    <ul>
        {% for entry in avg_ratings_per_day %}
            <li>{{ entry.created_at__date }} — {{ entry.avg|floatformat:2 }}</li>
        {% endfor %}
    </ul>

    <h2>Ratings Submitted per Day</h2>
    <ul>
        {% for entry in ratings_per_day %}
            <li>{{ entry.created_at__date }} — {{ entry.count }} ratings</li>
        {% endfor %}
    </ul>

    <!-- Chart for Average Ratings per Day -->
    <h3>Average Ratings per Day</h3>
    <canvas id="avgRatingsChart" width="400" height="200"></canvas>

    <!-- Chart for Ratings Submitted per Day -->
    <h3>Ratings Submitted per Day</h3>
    <canvas id="ratingsCountChart" width="400" height="200"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Average Ratings Chart
        const avgRatingsCtx = document.getElementById('avgRatingsChart').getContext('2d');
        new Chart(avgRatingsCtx, {
            type: 'line',
            data: {
                labels: [{% for entry in avg_ratings_per_day %}'{{ entry.created_at__date }}'{% if not forloop.last %}, {% endif %}{% endfor %}],
                datasets: [{
                    label: 'Average Rating',
                    data: [{% for entry in avg_ratings_per_day %}{{ entry.avg|floatformat:2 }}{% if not forloop.last %}, {% endif %}{% endfor %}],
                    borderColor: 'rgba(75, 192, 192, 1)',
                    fill: false,
                    tension: 0.3
                }]
            }
        });

        // Ratings Count Chart
        const ratingsCountCtx = document.getElementById('ratingsCountChart').getContext('2d');
        new Chart(ratingsCountCtx, {
            type: 'bar',
            data: {
                labels: [{% for entry in ratings_per_day %}'{{ entry.created_at__date }}'{% if not forloop.last %}, {% endif %}{% endfor %}],
                datasets: [{
                    label: 'Number of Ratings',
                    data: [{% for entry in ratings_per_day %}{{ entry.count }}{% if not forloop.last %}, {% endif %}{% endfor %}],
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            }
        });
    </script>
{% endblock %}
